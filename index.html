<!doctype html>
<html>

<head>
    <title>///</title>
    <meta charset="UTF-8">
    <meta http-equiv="cache-control" content="private,max-age=0,no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="///">
    <meta name="apple-mobile-web-app-title" content="///">
    <meta name="msapplication-starturl" content="/">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css">

    <style>
        html {
            height: 100vh;
        }
        
        .app {
            max-width: 600px;
            height: 100%;
        }
        
        * {
            font-family: 'Libre Franklin', sans-serif;
            font-size: 12px;
            font-display: swap;
        }
        
        a {
            color: black;
        }
        
        a:hover {
            color: black;
            text-decoration: none;
            border-bottom: .5px black solid;
        }
    </style>
    <script type="text/javascript">
        WebFontConfig = {
            google: {
                families: ['Libre+Franklin']
            }
        };
        (function() {
            var wf = document.createElement('script');
            wf.src = 'https://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
            wf.type = 'text/javascript';
            wf.async = 'true';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(wf, s);
        })();
    </script>
</head>

<body onload="onLoadAsync()">
    <div class="app mx-auto">
        <div class="card card-body p-4 m-4 border-0">
            <header class="header text-center px-2 mb-4"><small><a href="#"><h1 class="font-weight-bold">///</h1></a></small></header>
            <section class="content container px-2 mb-2"></section>
        </div>
    </div>
    <script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.15.0/umd/popper.min.js" async></script>
    <script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js" async></script>
    <script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.9.0/showdown.min.js" async></script>
    <script type="application/javascript">
        const APP_CDN = "https://cdn.jsdelivr.net/gh/noeramadhan/noeramadhan.github.io@master/posts/";
        const APP_BASE = "https://noeramadhan.github.io/posts/";
        $(document).ready(function() {
            route();
            $(window).on('hashchange', route);
        });

        function route() {
            document.getElementsByClassName('content')[0].innerHTML = "";
            var file = (location.hash ? location.hash : "#index").slice(1);
            file == "index" ? list() : read(file);
        }

        function read(name) {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', APP_CDN + name + '.md');
            xhr.onload = function() {
                if (xhr.status === 200) {
                    var data = xhr.responseText;
                    var converter = new showdown.Converter({
                            metadata: true
                        }),
                        html = converter.makeHtml(data),
                        meta = converter.getMetadata();
                    if (meta['title'] !== undefined) {
                        document.getElementsByClassName('content')[0].innerHTML += '<p><h5 class="font-weight-bold mb-0 pb-0">' + meta['title'] + '</h5><small class="text-muted">Posted on <span class="date"><small>' + meta['date'] + '</small></span></small></p>';
                    }
                    document.getElementsByClassName('content')[0].innerHTML += html;
                    document.title = "/// | " + meta['title'];
                }else{
                    read("404");
                }
            };
            xhr.send();
        }

        function list() {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', APP_BASE + 'list.json');
            xhr.onload = function() {
                if (xhr.status === 200) {
                    var data = JSON.parse(xhr.responseText);
                    data.posts.sort((a,b) => {
                        var dateA = a.date.split('/'), dateB = b.date.split('/');
                        return new Date(dateB[2], dateB[1], dateB[0]).getTime()-new Date(dateA[2], dateA[1], dateA[0]).getTime();
                    });
                    var content = '';
                    $.each(data.posts, function(key, meta) {
                        content += '<div class="row"><div class="col-5 p-2 text-right">';
                        content += meta['date'] + '</div><div class="col p-2 pl-4"><a href="#';
                        content += meta['slug']  + '"><span class="title font-weight-bold">';
                        content += meta['title'] + '</span></a><br><span class="text-muted">/';
                        content += meta['slug']  + '</span></div></div>';
                    });
                    document.getElementsByClassName('content')[0].innerHTML += content;
                    document.title = "///";
                }
            };
            xhr.send();
        }

        async function onLoadAsync() {
            if (navigator.serviceWorker) {
                try {
                    let serviceWorker = await navigator.serviceWorker.register('service.js')
                    // console.log(`Service worker registered ${serviceWorker}`)
                } catch (err) {
                    // console.error(`Failed to register service worker: ${err}`)
                }
            }
        }

    </script>
</body>

</html>